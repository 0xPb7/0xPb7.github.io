<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Klise Theme" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Klise Theme" /> <title> CSP-101 Part-1 - Klise Theme </title> <link rel="alternate" href="http://localhost:4000/CSP-101-Part-1-copy/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/CSP-101-Part-1-copy/" /> <meta name="description" content="He&#39;s writing in Bahasa about web technology and experience as a journal for documentation things that he learned, meet him @github." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="CSP-101 Part-1 | Prasanth Bodepu" /> <meta property="og:title" content="CSP-101 Part-1 | Prasanth Bodepu" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/CSP-101-Part-1-copy/" /> <meta property="og:description" content="He&#39;s writing in Bahasa about web technology and experience as a journal for documentation things that he learned, meet him @github." /> <meta property="og:image" content="http://localhost:4000/assets/img/ogp.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="CSP-101 Part-1 | 0xPb" /> <meta name="twitter:url" content="http://localhost:4000/CSP-101-Part-1-copy/" /> <meta name="twitter:site" content="@0xPb" /> <meta name="twitter:creator" content="@0xPb" /> <meta name="twitter:description" content="He&#39;s writing in Bahasa about web technology and experience as a journal for documentation things that he learned, meet him @github." /> <meta name="twitter:image" content="http://localhost:4000/assets/img/ogp.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Klise Theme" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- for mathjax support --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">Home</a><a class="menu-link" href="/archive/">Blog</a><a class="menu-link" href="/tags/">Categories</a><a class="menu-link" href="/about/">About</a><a class="menu-link rss" target="_blank" href="https://app.hackthebox.com/users/605904"> <ion-icon name="cube-outline"></ion-icon> </a> <a class="menu-link rss" target="_blank" href="https://linkedin.com/in/0xPb/"> <ion-icon name="logo-linkedin"></ion-icon> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#csp">CSP</a>, <a class="tag" href="/tags/#xss">XSS</a> </span> </div> <h1 class="header-title" itemprop="headline">CSP-101 Part-1</h1> <div class="post-meta"> <time datetime="2023-12-02T01:00:00+07:00" itemprop="datePublished"> Dec 02, 2023 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Prasanth Bodepu</span> </span> <time hidden datetime="2023-12-03T16:49:47+07:00" itemprop="dateModified"> Dec 02, 2023 </time> <span hidden itemprop="publisher" itemtype="Person">Prasanth Bodepu</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><h3 id="what-is-xss">What is XSS?</h3> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <h3 id="what-is-xss"> <a href="#what-is-xss" class="anchor-head"></a> What is XSS? </h3> <p>A malicious Injection of JavaScript into a webpage.</p> <h3 id="what-can-you-do-with-an-xss"> <a href="#what-can-you-do-with-an-xss" class="anchor-head"></a> What can you do with an XSS? </h3> <h4 id="the-attacker-can-do-anything-on-that-origin-that-the-user-can-do"> <a href="#the-attacker-can-do-anything-on-that-origin-that-the-user-can-do" class="anchor-head"></a> The attacker can do anything on that origin that the user can do </h4> <ul> <li>Read Private Messages</li> <li>Tweet Pro</li> <li>Credit Card Skimming</li> <li>Fake logout to steal credentials</li> </ul> <h4 id="for-financial-apps-medical-infra---its-much-more-serious"> <a href="#for-financial-apps-medical-infra---its-much-more-serious" class="anchor-head"></a> For Financial apps, Medical, Infra - it’s much more serious </h4> <ul> <li>steal funds</li> <li>Leak Medical Records</li> <li>Tear Down Infra</li> </ul> <h3 id="what-is-csp"> <a href="#what-is-csp" class="anchor-head"></a> What is CSP? </h3> <p>A tool to help prevent XSS exploitation.</p> <h3 id="how-does-it-prevent-xss-exploitation"> <a href="#how-does-it-prevent-xss-exploitation" class="anchor-head"></a> How does it prevent XSS exploitation? </h3> <p>It tells the browser which resources are allowed.</p> <h3 id="what-does-csp-look-like"> <a href="#what-does-csp-look-like" class="anchor-head"></a> What does CSP look like? </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>default-src 'self';
connect-src 'self'
font-src 'self' data: 
frame-src 'self' 
img-src 'self' data: https;
object-src 'none';
script-src 'self'
style-src 'self' 'unsafe-inline';
base-uri 'self';
</code></pre></div></div> <h3 id="how-is-csp-delivered"> <a href="#how-is-csp-delivered" class="anchor-head"></a> How is CSP delivered? </h3> <p>It’s delivered through the HTTP headers.</p> <p>HTTP Request</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /index.html HTTP/1.1
Host: app.com
User-Agent: Mozilla/5.0
Accept-Language: en-US
Accept-Encoding: gzip, delfate
</code></pre></div></div> <p>HTTP Response</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: Text/html
Content-LengthL 4567
Set-Cookie: user_session=abc123
Content-Security-Policy: default-src 'none', script-src 'self';

&lt;html&gt; &lt;title&gt;app.com&lt;/title&gt;&lt;/html&gt;
</code></pre></div></div> <h3 id="nodejs--express"> <a href="#nodejs--express" class="anchor-head"></a> NodeJS / Express </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>app.use(function(req, res, next) {}
	res.setHeader("Content-security-policy-report-only", "default-src 'self'; script-src 'self' 'report-sample'; next();
});
</code></pre></div></div> <h3 id="what-are-the-different-csp-directives"> <a href="#what-are-the-different-csp-directives" class="anchor-head"></a> What are the different CSP Directives? </h3> <p><strong><img src="https://lh7-us.googleusercontent.com/KoN3wPnNHTS3nSR2MI7jRMMFIUwuo41ki2umzwLQapezyIlAilWok1VuQdyf3z0FMth63NEb4IgJLKctO-bPpiBgavegchJQPGnfZxBMjNbhStqf28hGix238qwHb0ie9NK7rXvn2RmQ0s7kgY3gnn4vVw=s2048" alt="" /></strong></p> <p><strong><img src="https://lh7-us.googleusercontent.com/luehXo4iiFoRv2kqnqs5U3sqpoMkm4ro9GDPSCE8Gh-Mf-wFA_Vs5cshtWabIvy-90dHGcJCLGui6UVVPN4WBwDPjWm3I9558-5N0taRfkzNE9qbVqCwgW6niGjMe-gTkPC3GLhzoBl010W4WJLfye6qIA=s2048" alt="" /></strong></p> <h3 id="what-are-the-different-csp-sources"> <a href="#what-are-the-different-csp-sources" class="anchor-head"></a> What are the different CSP sources? </h3> <p><strong><img src="https://lh7-us.googleusercontent.com/x-aPtn0ErJ6X_wRS8rb5AqLSJZW5RYvofE7JoIy_SkUSytS8Ff-rJaeSwzLja7Ic_R2YSJX5V6bafp-vgX2THtEvkrH6150jSvB0Yvh-IQyd2c__8e1cfQd0o-X73XZX_RGiV36HmSaXN1jjtSRmVT9ZPQ=s2048" alt="" /></strong></p> <p><strong><img src="https://lh7-us.googleusercontent.com/DtnbiOahI0Q1iQ0YexXkoNH8nePir4QN4fj48ZIn8wR3Vs-fubDLx9e-LfjV3BPBWVa_WSNwpZsJ6qxjEDQ4OAurBJQVgafxlz32esV44WOjm0FZDgdfJg3aPYAjR9PFFKbXqyZplS9RReWqWj3gaCotyQ=s2048" alt="" /></strong></p> <h3 id="what-is-in-a-content-security-policy"> <a href="#what-is-in-a-content-security-policy" class="anchor-head"></a> What is in a Content Security Policy? </h3> <p>A list of ‘directives’ which contain ‘sources’</p> <h3 id="how-does-specifying-script-src-prevent-an-inline-xss"> <a href="#how-does-specifying-script-src-prevent-an-inline-xss" class="anchor-head"></a> How does specifying script-src prevent an inline XSS? </h3> <p>Inline scripts (and eval) are blocked</p> <h3 id="what-is-blocked-with-a-standard-content-security-policy"> <a href="#what-is-blocked-with-a-standard-content-security-policy" class="anchor-head"></a> What is blocked with a standard Content-Security-Policy? </h3> <p><img src="/_posts/CSP-101/def-package.png" alt="def-package" /></p> <p>Blocked:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;script src="https://evil.com/malicious.js"&gt;&lt;/script&gt;

&lt;button onclick="xxx"&gt;&lt;/button&gt; //CSP does not allow this

&lt;script&gt; //CSP does not allow this because it is an inline JS
	// app code
&lt;/script&gt;
</code></pre></div></div> <ul> <li>Because there’s no way to differentiate between malicious Inline JavaScript and allowed Inline JavaScript.</li> </ul> <h3 id="what-to-do-about-inline-scripts"> <a href="#what-to-do-about-inline-scripts" class="anchor-head"></a> What to do about inline scripts? </h3> <p>&lt;p style=”align:center”;&gt; Move to a file &lt;/p&gt;</p> <p><img src="/_posts/CSP-101/csp02.png" alt="csp01" /></p> <h3 id="what-if-i-cant-move-all-the-javascript"> <a href="#what-if-i-cant-move-all-the-javascript" class="anchor-head"></a> What if I can’t move all the JavaScript? </h3> <table> <thead> <tr> <th>sha256-abc123</th> <th>Hash the JavaScript and include the hash-source</th> <th> </th> </tr> </thead> <tbody> <tr> <td> </td> <td><script>normalAppCode</script></td> <td> </td> </tr> <tr> <td> </td> <td>Does not work on event_handlers, to include those, include ‘unsafe-hashes’</td> <td> </td> </tr> <tr> <td>nonce-abc-123</td> <td>Generate a random unique token on each request and add it to the script tags</td> <td> </td> </tr> <tr> <td> </td> <td><script nonce="abc123">normalAppCode</script></td> <td> </td> </tr> <tr> <td>‘unsafe-inline’</td> <td>Disable CSP’s XSS protection (not recommended)</td> <td> </td> </tr> </tbody> </table> <h3 id="what-about-eval"> <a href="#what-about-eval" class="anchor-head"></a> What about eval? </h3> <table> <thead> <tr> <th>‘unsafe-eval’</th> <th>Allows the use of eval</th> </tr> </thead> <tbody> <tr> <td> </td> <td>eval(), Function(‘’), setTimeout(‘’)</td> </tr> </tbody> </table> </div> </article> </main> <small class="post-updated-at">updated_at 03-12-2023</small> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/klown-cfm/" > <div class="nav-arrow">Previous</div> <span class="post-title">klown-cfm 🎪</span> </a> <a class="post-nav-item post-nav-next" href="/CSP-101-Part-2/"> <div class="nav-arrow">Next</div> <span class="post-title">CSP-101 Part-2</span> </a> </nav> <footer class="footer"> <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.10.0/css/all.css"> <!-- <a class="footer_item" href="/thanks">ack.</a> <a class="footer_item" href="javascript::void(0)">resume</a> --> <!-- <a class="footer_item" href="/feed.xml">rss</a> --> <span class="footer_item">&copy; 2023</span> <small class="footer_copyright"> <small class="text-muted mb-2"> <i class="fas fa-code"></i> with <i class="fa fa-heart" aria-hidden="false"></i> by <strong>Prasanth Bodepu</strong> </small> <br> <a class="social mx-1" href="mailto:prasanth.bodepu@gmail.com" style="color: rgb(108, 117, 125);" onmouseover="this.style.color='#db4437'" onmouseout="this.style.color='#6c757d'"> <i class="fas fa-envelope fa-1x"></i> </a> &nbsp;&nbsp; <a class="social mx-1" href="https://www.github.com/0xPb1" style="color: rgb(108, 117, 125);" onmouseover="this.style.color='#333333'" onmouseout="this.style.color='#6c757d'"> <i class="fab fa-github fa-1x"></i> </a> &nbsp;&nbsp; <a class="social mx-1" href="https://www.instagram.com/_0xpb" style="color: rgb(108, 117, 125);" onmouseover="this.style.color='#405de6'" onmouseout="this.style.color='#6c757d'"> <i class="fab fa-instagram fa-1x"></i> </a> &nbsp;&nbsp; <a class="social mx-1" href="https://www.linkedin.com/in/0xPb" style="color: #6c757d" onmouseover="this.style.color='#007bb5'" onmouseout="this.style.color='#6c757d'"> <i class="fab fa-linkedin-in fa-1x"></i> </a> &nbsp;&nbsp; <a class="social mx-1" href="https://www.twitter.com/_0xPb" style="color: #6c757d" onmouseover="this.style.color='#1da1f2'" onmouseout="this.style.color='#6c757d'"> <i class="fab fa-twitter fa-1x"></i> </a> </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
